version: "3.8"

services:
  envoy:
    image: envoyproxy/envoy:v1.17.0
    container_name: envoy
    volumes:
      - type: bind
        source: ../backend/envoy.yaml
        target: /etc/envoy/envoy.yaml
    ports:
      - "8081:8081"
  backend:
    image: simmonmt/xmaslist/backend
    container_name: backend
    command:
      - "--port=9090"
    ports:
      - "9090:9090"
  frontend:
    image: simmonmt/xmaslist/frontend
    container_name: frontend
    command:
      - "--port=8080"
      - "--serve_dir=/docroot"
      - "--index_file=index.html"
    ports:
      - "8080:8080"
    volumes:
      - type: bind
        source: ../bazel-bin/client/bundle.js
        target: /docroot/bundle.js
      - type: bind
        source: ../client/index.html
        target: /docroot/index.html
